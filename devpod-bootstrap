#!/usr/bin/env nix-shell
#! nix-shell -i sh -p stow

DOT_DIR="$(dirname $(readlink -f "$0"))/dotfiles"

dotfiles=(
  nvim
  tmux
  shell
  user_scripts
  tmuxifier
  nixpkgs
  git
)

. ./setup "${dotfiles[@]}"

# Install Nix packages from config.nix
nix-env -iA nixpkgs.devPackages

BASHRC="$HOME/.bashrc"
if [ -f "$BASHRC" ]; then
  extra=(
    "[ -f '${HOME}/.local/bin/colors.sh' ] && . ${HOME}/.local/bin/colors.sh"
    "[ -f '${HOME}/.config/shell/profile.default' ] && . ${HOME}/.config/shell/profile.default"
  )

  for line in "${extra[@]}"; do
    if ! grep -qxF "$line" "$BASHRC" 2>/dev/null; then
      printf "$line\n" >> "$BASHRC"
    fi
  done
fi
