#!/bin/bash
_networkcheck() {
    state=$(networksetup $check_action $device)
    echo "$state"
}

_networkconfig() {
    val=$(networksetup $check_action $device | grep -m1 $1 | cut -d' ' -f2)
    echo "$val"
}

_networktoggle() {
    if [ $1 == 'No' ]; then
        state='on'
    else
        state='off'
    fi
    networksetup $toggle_action $device $state
}

_run() {
    state=$(_networkconfig "Enabled")
    server=$(_networkconfig "Server")
    port=$(_networkconfig "Port")


    if [ $state == "No" ]; then
        reset=0

        if [[ $server != $default_server || $port != $default_port ]]; then
            reset=1
        fi

        if [ $reset -eq 1 ]; then
            networksetup $set_action $device $default_server $default_port
        fi

        networksetup $toggle_action $device "on"
    else
        networksetup $toggle_action $device "off"
    fi

    echo "$(_networkcheck)"
}

device='Wi-Fi'
default_server='127.0.0.1'
default_port='1080'
set_action="-setsocksfirewallproxy"
toggle_action='-setsocksfirewallproxystate'
check_action='-getsocksfirewallproxy'

_run
