#!/bin/env sh

wobfifo="${XDG_RUNTIME_DIR}/wob.fifo"
brightness_level="${XDG_CACHE_HOME}/brightness.level"


brightness() {
  local value="$(cat $brightness_level)"
  if [ -z "$value" ]; then
    value="$(ddcutil getvcp 10 | sed 's/\( \|,\)\+/ /g' | awk '{print $9}')"
  fi
  echo "$value"
}

set_brightness() {
  ddcutil setvcp 10 "$1" && echo "$1" | tee "$wobfifo" "$brightness_level"
}

bright_minus() {
  set_brightness "$(($(brightness) - 5))"
}

bright_plus() {
  set_brightness "$(($(brightness) + 5))"
}

case "$1" in
  --minus)
    bright_minus
    ;;
  --plus)
    bright_plus
    ;;
  --set)
    set_brightness "$2"
    ;;
  *)
    echo "Usage: bright <--minus | --plus>"
    exit 1
    ;;
esac
